{"ast":null,"code":"import _slicedToArray from\"C:/Users/bobso/Desktop/React Projects/07-authentication/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";var logoutTimer;var AuthContext=/*#__PURE__*/React.createContext({token:\"\",isLoggedIn:false,login:function login(token){},logout:function logout(){},timeout:null});var calculateRrmainingTime=function calculateRrmainingTime(expirationTime){var currentTime=new Date().getTime();var adjExpirationTime=new Date(expirationTime).getTime();var remainingDuration=adjExpirationTime-currentTime;return remainingDuration;};var retrieveStoredToken=function retrieveStoredToken(){var storedToken=localStorage.getItem(\"token\");var storedExpirationDate=localStorage.getItem(\"expirationTime\");var remainingTime=calculateRrmainingTime(storedExpirationDate);if(remainingTime<=3000){localStorage.removeItem(\"token\");localStorage.removeItem(\"expirationTime\");return null;}return{token:storedToken,duration:remainingTime};};export var AuthContextProvider=function AuthContextProvider(props){var tokenData=retrieveStoredToken();var initialToken;if(tokenData){initialToken=tokenData.token;}var _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var userIsLoggedIn=!!token;var logoutHandler=useCallback(function(){setToken(null);localStorage.removeItem(\"token\");localStorage.removeItem(\"expirationTime\");if(logoutTimer){clearTimeout(logoutTimer);}},[]);var loginHandler=function loginHandler(token,expirationTime){setToken(token);localStorage.setItem(\"token\",token);localStorage.setItem(\"expirationTime\",expirationTime);// Used to set the timeout correlated with Firebase (1h by default)\n// const remainingTime = calculateRrmainingTime(expirationTime);\nlogoutTimer=setTimeout(logoutHandler,3*60*1000);};useEffect(function(){if(tokenData){logoutTimer=setTimeout(logoutHandler,tokenData.duration);}},[tokenData,logoutHandler]);var contextValue={token:token,isLoggedIn:userIsLoggedIn,login:loginHandler,logout:logoutHandler};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:props.children});};export default AuthContext;","map":{"version":3,"names":["React","useState","useEffect","useCallback","logoutTimer","AuthContext","createContext","token","isLoggedIn","login","logout","timeout","calculateRrmainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","userIsLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","contextValue","children"],"sources":["C:/Users/bobso/Desktop/React Projects/07-authentication/src/store/auth-context.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\r\n\r\nlet logoutTimer;\r\n\r\nconst AuthContext = React.createContext({\r\n\ttoken: \"\",\r\n\tisLoggedIn: false,\r\n\tlogin: (token) => {},\r\n\tlogout: () => {},\r\n\ttimeout: null,\r\n});\r\n\r\nconst calculateRrmainingTime = (expirationTime) => {\r\n\tconst currentTime = new Date().getTime();\r\n\tconst adjExpirationTime = new Date(expirationTime).getTime();\r\n\r\n\tconst remainingDuration = adjExpirationTime - currentTime;\r\n\r\n\treturn remainingDuration;\r\n};\r\n\r\nconst retrieveStoredToken = () => {\r\n\tconst storedToken = localStorage.getItem(\"token\");\r\n\tconst storedExpirationDate = localStorage.getItem(\"expirationTime\");\r\n\r\n\tconst remainingTime = calculateRrmainingTime(storedExpirationDate);\r\n\r\n\tif (remainingTime <= 3000) {\r\n\t\tlocalStorage.removeItem(\"token\");\r\n\t\tlocalStorage.removeItem(\"expirationTime\");\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn {\r\n\t\ttoken: storedToken,\r\n\t\tduration: remainingTime,\r\n\t};\r\n};\r\n\r\nexport const AuthContextProvider = (props) => {\r\n\tconst tokenData = retrieveStoredToken();\r\n\tlet initialToken;\r\n\r\n\tif (tokenData) {\r\n\t\tinitialToken = tokenData.token;\r\n\t}\r\n\r\n\tconst [token, setToken] = useState(initialToken);\r\n\r\n\tconst userIsLoggedIn = !!token;\r\n\r\n\tconst logoutHandler = useCallback(() => {\r\n\t\tsetToken(null);\r\n\t\tlocalStorage.removeItem(\"token\");\r\n\t\tlocalStorage.removeItem(\"expirationTime\");\r\n\r\n\t\tif (logoutTimer) {\r\n\t\t\tclearTimeout(logoutTimer);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tconst loginHandler = (token, expirationTime) => {\r\n\t\tsetToken(token);\r\n\t\tlocalStorage.setItem(\"token\", token);\r\n\t\tlocalStorage.setItem(\"expirationTime\", expirationTime);\r\n\r\n\t\t// Used to set the timeout correlated with Firebase (1h by default)\r\n\t\t// const remainingTime = calculateRrmainingTime(expirationTime);\r\n\r\n\t\tlogoutTimer = setTimeout(logoutHandler, 3 * 60 * 1000);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (tokenData) {\r\n\t\t\tlogoutTimer = setTimeout(logoutHandler, tokenData.duration);\r\n\t\t}\r\n\t}, [tokenData, logoutHandler]);\r\n\r\n\tconst contextValue = {\r\n\t\ttoken: token,\r\n\t\tisLoggedIn: userIsLoggedIn,\r\n\t\tlogin: loginHandler,\r\n\t\tlogout: logoutHandler,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<AuthContext.Provider value={contextValue}>\r\n\t\t\t{props.children}\r\n\t\t</AuthContext.Provider>\r\n\t);\r\n};\r\n\r\nexport default AuthContext;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}